import{r as a,p as r,q as o,w as c,B as s,P as e}from"./vendor.62143b15.js";const i=s("div",{class:"markdown-body"},[s("blockquote",null,[s("p",null,"Custom API Endpoints register new API routes which can be used to infinitely extend the core functionality of the platform.")]),s("h2",{id:"1.-setup-the-boilerplate"},[e("1. Setup the Boilerplate "),s("a",{class:"header-anchor",href:"#1.-setup-the-boilerplate"},"#")]),s("p",null,[e("Custom endpoints are dynamically loaded from within your project\u2019s "),s("code",null,"/extensions/endpoints"),e(" folder. Keep in mind that the extensions directory is configurable within your env file, and may be located elsewhere.")]),s("p",null,[e("Each endpoint is registered using a registration function within a scoped directory. For example, to create a custom "),s("code",null,"/my-endpoint/"),e(" endpoint, you would add the following function to "),s("code",null,"/extensions/endpoints/my-endpoint/index.js"),e(".")]),s("pre",null,[s("code",{class:"language-js"},[s("span",{class:"hljs-built_in"},"module"),e(".exports = "),s("span",{class:"hljs-function"},[s("span",{class:"hljs-keyword"},"function"),e(),s("span",{class:"hljs-title"},"registerEndpoint"),e("("),s("span",{class:"hljs-params"},"router"),e(") ")]),e(`{
	router.get(`),s("span",{class:"hljs-string"},"'/'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Hello, World!'"),e(`));
};
`)])]),s("p",null,"You can also create several scoped endpoints within a single function:"),s("pre",null,[s("code",{class:"language-js"},[s("span",{class:"hljs-comment"},"// /my-endpoint/"),e(`
`),s("span",{class:"hljs-comment"},"// /my-endpoint/intro"),e(`
`),s("span",{class:"hljs-comment"},"// /my-endpoint/goodbye"),e(`
`),s("span",{class:"hljs-built_in"},"module"),e(".exports = "),s("span",{class:"hljs-function"},[s("span",{class:"hljs-keyword"},"function"),e(),s("span",{class:"hljs-title"},"registerEndpoint"),e("("),s("span",{class:"hljs-params"},"router"),e(") ")]),e(`{
	router.get(`),s("span",{class:"hljs-string"},"'/'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Hello, World!'"),e(`));
	router.get(`),s("span",{class:"hljs-string"},"'/intro'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Nice to meet you.'"),e(`));
	router.get(`),s("span",{class:"hljs-string"},"'/goodbye'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Goodbye!'"),e(`));
};
`)])]),s("h2",{id:"2.-develop-your-custom-endpoint"},[e("2. Develop your Custom Endpoint "),s("a",{class:"header-anchor",href:"#2.-develop-your-custom-endpoint"},"#")]),s("p",null,[e("The "),s("code",null,"registerEndpoint"),e(" function receives two parameters: "),s("code",null,"router"),e(" and "),s("code",null,"context"),e(". Router is an express Router instance that is scoped to "),s("code",null,"/<extension-name>"),e(", while "),s("code",null,"context"),e(" holds the following properties:")]),s("ul",null,[s("li",null,[s("code",null,"services"),e(" \u2014 All API internal services.")]),s("li",null,[s("code",null,"exceptions"),e(" \u2014\xA0API exception objects that can be used to throw \u201Cproper\u201D errors.")]),s("li",null,[s("code",null,"database"),e(" \u2014 Knex instance that is connected to the current database.")]),s("li",null,[s("code",null,"getSchema"),e(" \u2014 Async function that reads the full available schema for use in services")]),s("li",null,[s("code",null,"env"),e(" \u2014\xA0Parsed environment variables.")]),s("li",null,[s("code",null,"logger"),e(" \u2014\xA0"),s("a",{href:"https://github.com/pinojs/pino",target:"_blank",rel:"noopener noreferrer"},"Pino"),e(" instance.")])]),s("h2",{id:"3.-restart-the-api"},[e("3. Restart the API "),s("a",{class:"header-anchor",href:"#3.-restart-the-api"},"#")]),s("p",null,"To deploy your endpoint, simply restart the API by running:"),s("pre",null,[s("code",{class:"language-bash"},`npx directus start
`)]),s("h2",{id:"full-example%3A"},[e("Full Example: "),s("a",{class:"header-anchor",href:"#full-example%3A"},"#")]),s("pre",null,[s("code",{class:"language-js"},[s("span",{class:"hljs-comment"},"// extensions/endpoints/recipes/index.js"),e(`

`),s("span",{class:"hljs-built_in"},"module"),e(".exports = "),s("span",{class:"hljs-function"},[s("span",{class:"hljs-keyword"},"function"),e(),s("span",{class:"hljs-title"},"registerEndpoint"),e("("),s("span",{class:"hljs-params"},"router, { services, exceptions }"),e(") ")]),e(`{
	`),s("span",{class:"hljs-keyword"},"const"),e(` { ItemsService } = services;
	`),s("span",{class:"hljs-keyword"},"const"),e(` { ServiceUnavailableException } = exceptions;

	router.get(`),s("span",{class:"hljs-string"},"'/'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res, next"),e(") =>")]),e(` {
		`),s("span",{class:"hljs-keyword"},"const"),e(" recipeService = "),s("span",{class:"hljs-keyword"},"new"),e(" ItemsService("),s("span",{class:"hljs-string"},"'recipes'"),e(", { "),s("span",{class:"hljs-attr"},"schema"),e(": req.schema, "),s("span",{class:"hljs-attr"},"accountability"),e(`: req.accountability });

		recipeService
			.readByQuery({ `),s("span",{class:"hljs-attr"},"sort"),e(": [{ "),s("span",{class:"hljs-attr"},"column"),e(": "),s("span",{class:"hljs-string"},"'name'"),e(", "),s("span",{class:"hljs-attr"},"order"),e(": "),s("span",{class:"hljs-string"},"'asc'"),e(" }], "),s("span",{class:"hljs-attr"},"fields"),e(": ["),s("span",{class:"hljs-string"},"'*'"),e(`] })
			.then(`),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"results"),e(") =>")]),e(` res.json(results))
			.catch(`),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"error"),e(") =>")]),e(` {
				`),s("span",{class:"hljs-keyword"},"return"),e(" next("),s("span",{class:"hljs-keyword"},"new"),e(` ServiceUnavailableException(error.message));
			});
	});
};
`)])])],-1),j={setup(p,{expose:t}){const n={title:"Custom API Endpoints",modularExtension:!0};return t({frontmatter:n}),(u,h)=>{const l=a("DocsWrapper");return r(),o(l,{frontmatter:n},{default:c(()=>[i]),_:1})}}};export{j as default};
